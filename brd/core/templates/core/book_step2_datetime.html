{% extends 'base.html' %}

{% load dict_extras %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center mb-4">Выберите дату и время</h1>
    <p class="text-center">Услуга: <strong>{{ service.name }}</strong> | Мастер: <strong>{{ master.full_name }}</strong></p>
    
  <form method="post" action="{% url 'book_confirm' %}" class="mt-5">
    {% csrf_token %}
    <input type="hidden" name="service_id" value="{{ service.id }}">
    <input type="hidden" name="master_id" value="{{ master.id }}">
    
    <div class="row">
        <div class="col-md-6">
            <label class="fw-bold">Дата:</label>
            <select name="date" class="form-select mb-3" required>
                {% for date_option in dates %}
                <option value="{{ date_option|date:'Y-m-d' }}">{{ date_option|date:"d E Y" }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-6">
    <label class="fw-bold">Время:</label>
    <select name="time" class="form-select mb-3" required>
        {% for time in times %}
        {% with time_str=time %}
        {% with selected_date=request.POST.date|default:dates.0|date:"Y-m-d" %}
        {% if booked_slots|get_item:selected_date and time_str in booked_slots|get_item:selected_date %}
        <option value="{{ time }}" disabled>{{ time }} — занято</option>
        {% else %}
        <option value="{{ time }}">{{ time }}</option>
        {% endif %}
        {% endwith %}
        {% endwith %}
        {% endfor %}
    </select>
</div>
    
    <h4 class="mt-4">Ваши данные</h4>
    <div class="row">
        <div class="col-md-6">
            <input type="text" name="client_name" class="form-control mb-3" placeholder="Ваше имя" required>
        </div>
        <div class="col-md-6">
            <input type="tel" name="client_phone" class="form-control mb-3" placeholder="Телефон (+7...)" required>
        </div>
        <div class="col-md-12">
            <input type="email" name="client_email" class="form-control mb-3" placeholder="Email (необязательно)">
        </div>
    </div>
    
    <div class="text-center">
        <button type="submit" class="btn btn-primary btn-lg">Подтвердить запись</button>
    </div>
</form>
    
    <div class="text-center mt-4">
        <a href="{% url 'book_service' service.id %}" class="btn btn-secondary">← Назад к выбору мастера</a>
    </div>
</div>
{% endblock %}